# 安装排除配置功能需求文档

## 功能概述
本功能为Claude模型切换器添加文件排除配置能力，允许在安装过程中排除特定文件或目录不被复制到目标安装目录，同时禁用卸载过程中对Claude Code CLI的卸载提示。

## 核心需求

### 1. 文件排除配置功能

**用户故事**: 作为系统管理员，我希望能够配置文件排除规则，以便在安装过程中跳过不需要的文件或目录。

**验收标准**:
1.1. **当** 安装脚本运行时，**应** 读取排除配置文件
1.2. **当** 排除配置文件存在时，**应** 解析排除规则并按规则跳过相应文件
1.3. **当** 排除规则包含通配符模式时，**应** 正确匹配文件路径
1.4. **当** 排除规则无效时，**应** 记录警告并继续安装过程
1.5. **当** 安装完成时，**应** 验证排除的文件确实未被复制

### 2. 排除规则语法定义

**用户故事**: 作为开发者，我希望有明确的排除规则语法定义，以便正确配置排除规则。

**验收标准**:
2.1. **当** 配置排除规则时，**应** 支持以下语法：
   - 精确文件路径匹配：`/path/to/file.txt`
   - 通配符匹配：`*.log`, `temp_*`
   - 目录排除：`/path/to/directory/`
   - 注释支持：以`#`开头的行
2.2. **当** 规则包含相对路径时，**应** 相对于项目根目录解析
2.3. **当** 规则包含绝对路径时，**应** 直接匹配绝对路径

### 3. 配置文件位置和格式

**用户故事**: 作为用户，我希望排除配置文件位于标准位置且格式简单，以便易于编辑。

**验收标准**:
3.1. **当** 配置文件不存在时，**应** 使用默认行为（不排除任何文件）
3.2. **当** 配置文件存在时，**应** 位于项目根目录下的`.claude-exclude`文件
3.3. **当** 配置文件格式错误时，**应** 提供清晰的错误信息
3.4. **当** 配置文件被修改时，**应** 在下一次安装时生效

### 4. 禁用Claude Code CLI卸载提示

**用户故事**: 作为用户，我希望卸载过程不再询问是否卸载Claude Code CLI，以便简化卸载流程。

**验收标准**:
4.1. **当** 执行卸载操作时，**应** 不再显示"是否卸载Claude Code CLI"的提示
4.2. **当** 卸载过程完成时，**应** 只移除Claude模型切换器相关文件
4.3. **当** 用户明确要求卸载Claude Code CLI时，**应** 通过其他机制支持（如命令行参数）

### 5. 向后兼容性

**用户故事**: 作为现有用户，我希望新功能不会破坏现有的安装和卸载流程。

**验收标准**:
5.1. **当** 排除配置文件不存在时，**应** 保持现有安装行为不变
5.2. **当** 现有脚本调用安装功能时，**应** 继续正常工作
5.3. **当** 卸载功能被调用时，**应** 保持对Claude Code CLI的现有处理逻辑

### 6. 错误处理和日志记录

**用户故事**: 作为运维人员，我希望有详细的错误处理和日志记录，以便排查问题。

**验收标准**:
6.1. **当** 排除规则解析失败时，**应** 记录警告并继续安装
6.2. **当** 文件复制过程中出现权限问题时，**应** 提供明确的错误信息
6.3. **当** 功能正常工作时，**应** 在日志中记录排除的文件列表

## 配置示例

### 示例排除配置文件 (.claude-exclude)
```
# 排除日志文件
*.log
*.tmp

# 排除测试目录
tests/
tests/results/

# 排除文档目录（保留README.md）
docs/
!README.md

# 排除特定配置文件
config/mcp.json.backup
```

### 示例用法
```bash
# 安装时自动应用排除规则
./install.sh

# 强制包含所有文件（忽略排除规则）
IGNORE_EXCLUDE=1 ./install.sh
```

## 非功能性需求

1. **性能**: 排除功能不应显著增加安装时间
2. **安全性**: 排除规则不应允许目录遍历攻击
3. **可维护性**: 代码应模块化，易于测试和维护
4. **兼容性**: 支持现有的Shell脚本环境